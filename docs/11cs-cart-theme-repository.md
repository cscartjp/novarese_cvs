# テーマリポジトリの重要性

## 8.1 テーマリポジトリとは

CS-Cartでは、テーマファイルは二箇所に存在します：

```
📁 design/themes/{theme}/   - 実際に使用されるテーマファイル
📁 var/themes_repository/   - テーマファイルのリポジトリ（マスターコピー）
```

テーマリポジトリ（`var/themes_repository`）は、テーマファイルのマスターコピーを保持する重要なディレクトリです。アドオンのインストール時には、このリポジトリからファイルが`design/themes/{theme}`ディレクトリにコピーされます。

## 8.2 アドオン開発でのテーマリポジトリの扱い

### 8.2.1 テーマリポジトリとテーマディレクトリの関係

アドオン開発において、以下の点に注意する必要があります：

```
📁 var/themes_repository/{theme}/templates/addons/{addon_id}/
📁 design/themes/{theme}/templates/addons/{addon_id}/
```

これらの二つのディレクトリは常に同期されている必要があります。

### 8.2.2 開発時の注意点

1. **テンプレートの修正**
   - `design/themes/{theme}/templates/addons/{addon_id}/`のみを修正した場合、その変更は一時的なものとなります
   - アドオンの再インストールや他の環境へのインストール時に、修正が失われます

2. **正しい開発フロー**
   - **常にテーマリポジトリのファイルを編集する**：`var/themes_repository/{theme}/templates/addons/{addon_id}/`
   - 修正後にフロントエンドで変更を確認する場合は、以下のいずれかの方法を使用：
     - テーマの再デプロイ（管理画面 > デザイン > テーマ > [テーマ名] > デプロイ）
     - 手動でファイルをコピー
     - 開発環境ではデバッグモードでテーマリポジトリを直接参照するよう設定

3. **アドオンのパッケージング時**
   - 必ず`var/themes_repository`内のファイルを含める
   - これにより、他の環境にインストールした際に正しくテンプレートが適用される

### 8.2.3 キャッシュと開発効率の向上

CS-Cartではパフォーマンス向上のためにテンプレートがキャッシュされるため、テンプレートファイルを変更しても即座に反映されないことがあります。開発効率を向上させるために以下の設定が有効です：

1. **キャッシュの自動リビルド**
   - 管理画面 > デザイン > テーマ > (テーマを選択) > 「キャッシュの自動リビルド」をONに設定
   - この設定により、テンプレートのキャッシュが作成されなくなり、ブラウザの更新だけで変更を確認できます
   - 注意：全く新しいテンプレートフックを作成した場合など、一部の変更はこの設定でも反映されないことがあります。その場合は次の方法でテンプレートキャッシュの強制クリアが必要です

2. **テンプレートキャッシュの強制クリア**
   - 管理画面 > 設定 > 保存データ > キャッシュ > 「テンプレート」を選択 > 「クリア」をクリック
   - または直接 `var/cache/templates/`ディレクトリの内容を削除

3. **テーマリポジトリからの自動デプロイを設定する方法**
   開発効率を上げるため、`config.local.php`にデバッグモードを設定することで、テーマリポジトリの変更をリアルタイムで反映させることができます：

   ```php
   <?php
   // config.local.php

   // デバッグモードを有効化
   define('DEBUG_MODE', true);

   // テーマリポジトリから直接テンプレートを読み込む
   define('DEVELOPMENT', true);
   ```

   この設定により、`var/themes_repository/`内のファイルを編集するだけで、変更がフロントエンドに即時反映されるようになります。本番環境では必ずこの設定を無効化してください。

4. **開発モード中の推奨設定**
   以下の設定を組み合わせることで、最も効率的な開発環境を構築できます：
   - キャッシュの自動リビルドをON
   - config.local.phpでDEVELOPMENTをtrue
   - ブラウザの開発者ツールでネットワークキャッシュを無効化